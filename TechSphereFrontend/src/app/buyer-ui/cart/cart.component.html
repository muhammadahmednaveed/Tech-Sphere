<div class="album py-5 bg-light text-center">
  <div class="container">
    <h1>Your Cart</h1>
    <div *ngIf="!cartNotEmpty" class="row row-cols-1 row-cols-sm-2 g-3 mt-3">
      <h3>Your cart is Empty, Please add some products</h3>
      <p>
        <a routerLink="../products/allproducts" class="btn btn-primary"
          >Go to All Products</a
        >
      </p>
    </div>
    <div
      *ngIf="cartNotEmpty"
      class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3 mt-3"
    >
      <table class="table">
        <thead>
          <tr>
            <th scope="col">Sr No.</th>
            <th scope="col">Product</th>
            <th scope="col">Price</th>
            <th scope="col">Quantity</th>
            <th scope="col">Total Price</th>
            <th scope="col">Remove Product</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of cart.Products">
            <td>TSP{{ item.Id }}</td>
            <td>{{ item.Title }}</td>
            <td>{{ item.Price | currency }}</td>
            <td>
              <!-- <button class="" (click)="minus(item)">-</button> -->
              <input
                type="number"
                (blur)="changeQuantity(item)"
                [(ngModel)]="item.Quantity"
                (ngModelChange)="totalUpdate()"
                [value]="item.Quantity"
                min="1"
                [max]="item.Inventory"
                style="width: 40px"
                onkeydown="return false"
              />
              <!-- <a class="" (click)="plus(item)">
                <i class="fa-solid fa-plus"></i>
              </a> -->
            </td>
            <td>{{ item.Price * item.Quantity | currency }}</td>
            <td>
              <!-- <button (click)="add(item.Id)" class="btn btn-primary me-2">
                Add</button
              > -->
              <button (click)="remove(item.Id)" class="btn btn-danger">
                Remove
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      <div style="margin: 0 auto">
        <h3>Your Total is: {{ cart.TotalPrice | currency }}</h3>
        <button (click)="checkout()" class="btn btn-primary mt-3">
          Checkout
        </button>
      </div>
    </div>
    <div class="album py-5 bg-light text-center">
      <button
        *ngIf="allCartsClosed"
        (click)="getAllCarts()"
        class="btn btn-primary"
      >
        Purchase History
      </button>
      <button
        *ngIf="!allCartsClosed"
        (click)="getAllCarts()"
        class="btn btn-primary"
      >
        Hide Purchase History
      </button>
    </div>
    <div *ngIf="noPurchaseHistory">
      <h4>You have no prior purchases</h4>
    </div>
    <div *ngIf="!allCartsClosed" class="accordion" id="accordionExample">
      <div *ngFor="let item of allCarts; let i = index" class="accordion-item">
        <h2 class="accordion-header" id="headingOne">
          <button
            class="accordion-button collapsed"
            type="button"
            data-bs-toggle="collapse"
            attr.data-bs-target="#{{ item.CartId }}"
            aria-expanded="true"
            attr.aria-controls="{{ item.CartId }}"
          >
            <em>Cart # {{ item.CartId }}</em>
            <strong class="ms-3 me-1"> Purchase Date:</strong>
            {{ item.PurchaseDate | date : "short" }}
            <strong class="ms-3 me-1"> Products:</strong>
            {{ item.Products.length }}
          </button>
        </h2>
        <div
          id="{{ item.CartId }}"
          class="accordion-collapse collapse"
          aria-labelledby="headingOne"
          data-bs-parent="#accordionExample"
        >
          <div class="accordion-body">
            <table class="table">
              <thead>
                <tr>
                  <th scope="col">Sr No.</th>
                  <th scope="col">Product</th>
                  <th scope="col">Price</th>
                  <th scope="col">Quantity</th>
                  <th scope="col">Total Price</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item2 of item.Products">
                  <td>TSP{{ item2.Id }}</td>
                  <td>{{ item2.Title }}</td>
                  <td>{{ item2.Price | currency }}</td>
                  <td>{{ item2.Quantity }}</td>
                  <td>{{ item2.Price * item2.Quantity | currency }}</td>
                </tr>
              </tbody>
            </table>
            <div style="margin: 0 auto">
              <h5>Your Total was: {{ item.TotalPrice | currency }}</h5>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
